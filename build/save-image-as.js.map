{"version":3,"sources":["webpack://SaveImageAs/./src/save-image-as.ts","webpack://SaveImageAs/webpack/bootstrap","webpack://SaveImageAs/webpack/startup"],"names":["EExportFormat","ERejectReason","SaveImageAs","maxImageWidth","exportFormat","PNG","exportQuality","this","img","Promise","resolve","reject","canvas","document","createElement","ctx","getContext","scaleRatio","width","height","drawImage","reader","FileReader","onloadend","result","cleanUp","toString","onerror","COULD_NOT_READ","onabort","ABORTED","toBlob","blob","readAsDataURL","EMPTY_TRANSFER","data","body","appendChild","style","position","opacity","left","addEventListener","imageLoaded","IMAGE_COULD_NOT_LOADED","src","e","el","target","files","length","onload","readerEvent","imageData","FILE_HAS_NO_READIBLE_DATA","NO_IMAGE_FILE_SELECTED","maxWidth","quality","JPEG","JPG","WEBP","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__"],"mappings":"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","file":"save-image-as.js","sourcesContent":["export enum EExportFormat {\n  JPG = \"image/jpeg\",\n  PNG = \"image/png\",\n  GIF = \"image/gif\",\n  WEBP = \"image/webp\",\n  TIFF = \"image/tiff\",\n}\n\nexport type EExportQuality = number;\nexport enum ERejectReason {\n  COULD_NOT_READ = \"COULD_NOT_READ\",\n  ABORTED = \"ABORTED\",\n  EMPTY_TRANSFER = \"EMPTY_TRANSFER\",\n  IMAGE_COULD_NOT_LOADED = \"IMAGE_COULD_NOT_LOADED\",\n  FILE_HAS_NO_READIBLE_DATA = \"FILE_HAS_NO_READIBLE_DATA\",\n  NO_IMAGE_FILE_SELECTED = \"NO_IMAGE_FILE_SELECTED\",\n}\n\nclass SaveImageAs {\n  /**\n   * Allow maximal width for the exported image. Height will be calculated using original aspect ratio to avoid distortion\n   */\n  maxImageWidth: number;\n  /** \n    Exported file format \n   */\n  exportFormat: EExportFormat;\n  /**\n   * Quality of exported image accepts value between 0-1.\n   */\n  exportQuality: EExportQuality;\n\n  constructor({ maxImageWidth = 200, exportFormat = EExportFormat.PNG, exportQuality = 0.7 }) {\n    this.maxImageWidth = maxImageWidth;\n    this.exportFormat = exportFormat;\n    this.exportQuality = exportQuality;\n  }\n  private cleanUp(img: HTMLImageElement): void {\n    // document.body.removeChild(img);\n  }\n\n  private imageLoaded(img: HTMLImageElement): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const canvas = document.createElement(\"canvas\");\n      const ctx = canvas.getContext(\"2d\");\n      const scaleRatio = this.maxImageWidth < img.width ? img.width / this.maxImageWidth : 1;\n      canvas.width = img.width / scaleRatio;\n      canvas.height = img.height / scaleRatio;\n\n      ctx?.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n      const reader = new FileReader();\n\n      reader.onloadend = (): void => {\n        const { result } = reader;\n        this.cleanUp(img);\n        resolve(result?.toString() || \"\");\n      };\n      reader.onerror = (): void => {\n        this.cleanUp(img);\n        reject(ERejectReason.COULD_NOT_READ);\n      };\n      reader.onabort = (): void => {\n        this.cleanUp(img);\n        reject(ERejectReason.ABORTED);\n      };\n\n      canvas.toBlob(\n        blob => {\n          if (blob !== null) {\n            reader.readAsDataURL(blob);\n          } else {\n            this.cleanUp(img);\n            reject(ERejectReason.EMPTY_TRANSFER);\n          }\n        },\n        this.exportFormat,\n        this.exportQuality\n      );\n    });\n  }\n  private imageData(data: string): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const img = document.createElement(\"img\");\n      document.body.appendChild(img);\n      img.style.position = \"fixed\";\n      img.style.opacity = \"0\";\n      img.style.left = this.maxImageWidth * -100 + \"px\";\n      img.addEventListener(\"load\", () => {\n        resolve(this.imageLoaded(img));\n      });\n      img.addEventListener(\"error\", () => {\n        reject(ERejectReason.IMAGE_COULD_NOT_LOADED);\n        this.cleanUp(img);\n      });\n      img.src = data;\n    });\n  }\n\n  public onChange(e: Event): Promise<string> {\n    const el = e.target as HTMLInputElement;\n    return new Promise((resolve, reject) => {\n      if (el?.files && el.files.length > 0) {\n        const reader = new FileReader();\n        reader.onload = (readerEvent: ProgressEvent<FileReader>): void => {\n          const data = readerEvent.target?.result;\n\n          if (data) {\n            resolve(this.imageData(data.toString()));\n          } else {\n            reject(ERejectReason.FILE_HAS_NO_READIBLE_DATA);\n          }\n        };\n        reader.readAsDataURL(el.files[0]);\n      } else {\n        reject(ERejectReason.NO_IMAGE_FILE_SELECTED);\n      }\n    });\n  }\n}\n\nexport const PNG = (maxWidth: number, quality: EExportQuality): SaveImageAs => {\n  return new SaveImageAs({ maxImageWidth: maxWidth, exportFormat: EExportFormat.PNG, exportQuality: quality });\n};\nexport const JPEG = (maxWidth: number, quality: EExportQuality): SaveImageAs => {\n  return new SaveImageAs({ maxImageWidth: maxWidth, exportFormat: EExportFormat.JPG, exportQuality: quality });\n};\nexport const WEBP = (maxWidth: number, quality: EExportQuality): SaveImageAs => {\n  return new SaveImageAs({ maxImageWidth: maxWidth, exportFormat: EExportFormat.WEBP, exportQuality: quality });\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(743);\n"],"sourceRoot":""}